import os
import sys
import pandas as pd
import numpy as np
from PermissionsList.xml_parsing import GetPermissions
from Utils.util import getOneHot
import warnings
warnings.filterwarnings("ignore")

def main():
    if len(sys.argv)==1:
        print("ERROR: apk file missing.")
        sys.exit(0)
    elif len(sys.argv)==2:
        apk_path=sys.argv[1]
        if os.path.isfile(apk_path):
            if len(apk_path)>4 and apk_path[-4:]=='.apk':    
                os.system('androguard axml -o manifest/AndroidManifest.xml '+str(sys.argv[1]))
                perms=GetPermissions()
                blueprint=pd.read_csv('Utils/blueprint.csv')
                perm_df=getOneHot(perms,blueprint)
                print(len(perms),'permissions found.')

            else:
                print('ERROR: apk file required.')
        else:
            print("ERROR: Invalid path to apk.")
            sys.exit(0)
    else:
        print('Only 1 arguments required. Given',len(sys.argv)-1)
        sys.exit(0)

if __name__ == '__main__':
    main()